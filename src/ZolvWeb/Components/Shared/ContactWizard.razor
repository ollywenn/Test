@rendermode InteractiveServer

<div class="contact-wizard">
    <div class="wizard-progress">
        <div class="progress-step @(currentStep >= 1 ? "active" : "")">
            <span class="step-number">1</span>
        </div>
        <div class="progress-line @(currentStep >= 2 ? "active" : "")"></div>
        <div class="progress-step @(currentStep >= 2 ? "active" : "")">
            <span class="step-number">2</span>
        </div>
        <div class="progress-line @(currentStep >= 3 ? "active" : "")"></div>
        <div class="progress-step @(currentStep >= 3 ? "active" : "")">
            <span class="step-number">3</span>
        </div>
    </div>

    @if (currentStep == 1)
    {
        <div class="wizard-content">
            <h3>How do you want to partner with us?</h3>
            
            <div class="partnership-options">
                @foreach (var option in partnershipOptions)
                {
                    <div class="option-card @(selectedPartnership == option ? "selected" : "")" @onclick="() => SelectPartnership(option)">
                        <div class="option-radio">
                            @if (selectedPartnership == option)
                            {
                                <span class="checkmark">✓</span>
                            }
                        </div>
                        <span class="option-label">@option</span>
                    </div>
                }
            </div>
            
            <button class="btn btn-primary wizard-next" @onclick="NextStep" disabled="@(string.IsNullOrEmpty(selectedPartnership))">Next</button>
        </div>
    }
    else if (currentStep == 2)
    {
        <div class="wizard-content">
            <h3>Your contact information</h3>
            
            <EditForm Model="@contactInfo" OnValidSubmit="NextStep">
                <DataAnnotationsValidator />
                
                <div class="form-group">
                    <label>Name *</label>
                    <InputText @bind-Value="contactInfo.Name" class="form-control" placeholder="Your name" />
                    <ValidationMessage For="@(() => contactInfo.Name)" />
                </div>
                
                <div class="form-group">
                    <label>Email *</label>
                    <InputText @bind-Value="contactInfo.Email" class="form-control" placeholder="your.email@company.com" type="email" />
                    <ValidationMessage For="@(() => contactInfo.Email)" />
                </div>
                
                <div class="form-group">
                    <label>Phone</label>
                    <InputText @bind-Value="contactInfo.Phone" class="form-control" placeholder="+44 123 456 7890" />
                </div>
                
                <div class="form-group">
                    <label>Company *</label>
                    <InputText @bind-Value="contactInfo.Company" class="form-control" placeholder="Your company name" />
                    <ValidationMessage For="@(() => contactInfo.Company)" />
                </div>
                
                <div class="wizard-buttons">
                    <button type="button" class="btn btn-secondary" @onclick="PreviousStep">Previous</button>
                    <button type="submit" class="btn btn-primary">Next</button>
                </div>
            </EditForm>
        </div>
    }
    else if (currentStep == 3)
    {
        <div class="wizard-content">
            <h3>Tell us about your project</h3>
            
            <EditForm Model="@projectInfo" OnValidSubmit="SubmitForm">
                <DataAnnotationsValidator />
                
                <div class="form-group">
                    <label>Project details *</label>
                    <InputTextArea @bind-Value="projectInfo.Details" class="form-control" rows="6" placeholder="Tell us about your project requirements..." />
                    <ValidationMessage For="@(() => projectInfo.Details)" />
                </div>
                
                <div class="form-group">
                    <label>Budget range</label>
                    <InputSelect @bind-Value="projectInfo.BudgetRange" class="form-control">
                        <option value="">Select a range</option>
                        <option value="Under £50k">Under £50k</option>
                        <option value="£50k - £100k">£50k - £100k</option>
                        <option value="£100k - £250k">£100k - £250k</option>
                        <option value="£250k+">£250k+</option>
                    </InputSelect>
                </div>
                
                <div class="form-group">
                    <label>Timeline</label>
                    <InputSelect @bind-Value="projectInfo.Timeline" class="form-control">
                        <option value="">Select timeline</option>
                        <option value="Immediate">Immediate</option>
                        <option value="1-3 months">1-3 months</option>
                        <option value="3-6 months">3-6 months</option>
                        <option value="6+ months">6+ months</option>
                    </InputSelect>
                </div>
                
                <div class="wizard-buttons">
                    <button type="button" class="btn btn-secondary" @onclick="PreviousStep">Previous</button>
                    <button type="submit" class="btn btn-primary" disabled="@isSubmitting">
                        @(isSubmitting ? "Submitting..." : "Submit")
                    </button>
                </div>
            </EditForm>
        </div>
    }
    else if (currentStep == 4)
    {
        <div class="wizard-content wizard-success">
            <div class="success-icon">✓</div>
            <h3>Thank you for your inquiry!</h3>
            <p>We've received your message and will get back to you within 24 hours.</p>
            <p>Partnership type: <strong>@selectedPartnership</strong></p>
            <button class="btn btn-primary" @onclick="ResetWizard">Submit another inquiry</button>
        </div>
    }
</div>

@code {
    private int currentStep = 1;
    private string selectedPartnership = "";
    private bool isSubmitting = false;
    
    private ContactInfo contactInfo = new();
    private ProjectInfo projectInfo = new();
    
    private List<string> partnershipOptions = new()
    {
        "Integration and development",
        "Design build and support",
        "Development partner",
        "Strategic development partner",
        "Strategic consultancy"
    };
    
    private void SelectPartnership(string option)
    {
        selectedPartnership = option;
    }
    
    private void NextStep()
    {
        currentStep++;
    }
    
    private void PreviousStep()
    {
        currentStep--;
    }
    
    private async Task SubmitForm()
    {
        isSubmitting = true;
        
        // Simulate API call
        await Task.Delay(1000);
        
        // In production, this would send email via EmailService
        // For now, just move to success step
        currentStep = 4;
        isSubmitting = false;
    }
    
    private void ResetWizard()
    {
        currentStep = 1;
        selectedPartnership = "";
        contactInfo = new();
        projectInfo = new();
    }
    
    public class ContactInfo
    {
        [Required(ErrorMessage = "Name is required")]
        public string Name { get; set; } = "";
        
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string Email { get; set; } = "";
        
        public string Phone { get; set; } = "";
        
        [Required(ErrorMessage = "Company name is required")]
        public string Company { get; set; } = "";
    }
    
    public class ProjectInfo
    {
        [Required(ErrorMessage = "Please provide project details")]
        [MinLength(20, ErrorMessage = "Please provide at least 20 characters")]
        public string Details { get; set; } = "";
        
        public string BudgetRange { get; set; } = "";
        public string Timeline { get; set; } = "";
    }
}
